<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificador de link</title>  
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    
<div class="scene">
    <div class="carousel" id="carousel">

      <div class="card" id="card1" data-id="card1">
        <img src="https://iili.io/3QhqthF.jpg" alt="references">
        <h3>Verificar</h3>
      </div>
    </div>
  </div>
  
  <div id="popup-card1" class="popup">
    <h2>Verificador de URL</h2>
    
    <div>
      <input type="text" class="camp" placeholder="Digite a URL para verificar...">
    </div>
    
    <div class="loading-container">
      <div class="loading"></div>
    </div>
    
    <div class="loading-text">
      Verificando URL, aguarde...
    </div>
    
    <div class="result-container">
      <!-- Resultado da verificação aparecerá aqui -->
    </div>
    
    <button class="popup-verify" onclick="verifyURL()">Verificar</button>
    <button class="popup-close" onclick="closePopup()">Fechar</button>
  </div>
  

 <script>
    // BOTÃO DE DOAÇÃO - Adiciona automaticamente
    document.addEventListener("DOMContentLoaded", () => {
        // Cria os estilos CSS diretamente via JavaScript
        const style = document.createElement('style');
        style.textContent = `
            .custom-donation-container {
                position: fixed !important;
                top: 20px !important;
                right: 20px !important;
                z-index: 99999 !important;
                pointer-events: auto !important;
            }
            
            .donation-btn {
                background: linear-gradient(45deg, #ff6b35, #f7931e) !important;
                color: white !important;
                padding: 10px 18px !important;
                border-radius: 30px !important;
                text-decoration: none !important;
                font-size: 14px !important;
                font-weight: 700 !important;
                transition: all 0.3s ease !important;
                box-shadow: 0 4px 20px rgba(255, 107, 53, 0.5) !important;
                border: none !important;
                display: flex !important;
                align-items: center !important;
                gap: 8px !important;
                cursor: pointer !important;
                position: relative !important;
                z-index: 100000 !important;
                min-height: 40px !important;
                white-space: nowrap !important;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif !important;
            }
            
            .donation-btn:hover {
                transform: translateY(-3px) scale(1.05) !important;
                box-shadow: 0 8px 30px rgba(255, 107, 53, 0.7) !important;
                color: white !important;
                text-decoration: none !important;
                background: linear-gradient(45deg, #ff7b45, #f8a31e) !important;
            }
            
            .donation-btn:active {
                transform: translateY(-1px) scale(1.02) !important;
            }
            
            .donation-btn:visited {
                color: white !important;
            }
            
            .heart-icon {
                font-size: 18px !important;
                animation: heartbeat 2.5s infinite !important;
                display: inline-block !important;
                filter: drop-shadow(0 0 3px rgba(255,255,255,0.3)) !important;
            }
            
            @keyframes heartbeat {
                0%, 100% { transform: scale(1); }
                25% { transform: scale(1.1); }
                50% { transform: scale(1.2); }
                75% { transform: scale(1.1); }
            }
            
            /* Responsivo para mobile */
            @media (max-width: 480px) {
                .custom-donation-container {
                    top: 15px !important;
                    right: 15px !important;
                }
                
                .donation-btn {
                    padding: 8px 14px !important;
                    font-size: 13px !important;
                    min-height: 36px !important;
                }
                
                .heart-icon {
                    font-size: 16px !important;
                }
            }
        `;
        document.head.appendChild(style);

        // Cria o botão de doação flutuante
        function createFloatingDonationButton() {
            // Verifica se o botão já existe
            if (document.querySelector('.donation-btn')) {
                return;
            }

            // Cria container fixo
            const container = document.createElement('div');
            container.className = 'custom-donation-container';
            container.setAttribute('id', 'donation-container');
            
            // Cria o botão de doação
            const donationBtn = document.createElement('a');
            donationBtn.href = 'https://www.paypal.com/donate/?hosted_button_id=YQ8YYZEUH2VHC';
            donationBtn.className = 'donation-btn';
            donationBtn.target = '_blank';
            donationBtn.rel = 'noopener noreferrer';
            donationBtn.setAttribute('aria-label', 'Fazer doação via PayPal');
            donationBtn.setAttribute('title', 'Apoie este projeto com uma doação');
            
            // Cria o ícone do coração
            const heartIcon = document.createElement('span');
            heartIcon.className = 'heart-icon';
            heartIcon.textContent = '❤️';
            
            // Cria o texto do botão
            const textSpan = document.createElement('span');
            textSpan.textContent = 'Doar';
            textSpan.style.fontWeight = '700';
            
            // Monta o botão
            donationBtn.appendChild(heartIcon);
            donationBtn.appendChild(textSpan);
            
            // Adiciona o botão ao container
            container.appendChild(donationBtn);
            
            // Adiciona ao body
            document.body.appendChild(container);
            
            // Adiciona eventos
            donationBtn.addEventListener('click', (e) => {
                // Efeito visual no clique
                donationBtn.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    donationBtn.style.transform = '';
                }, 150);
            });
            
            // Animação de entrada
            setTimeout(() => {
                container.style.opacity = '0';
                container.style.transform = 'translateY(-20px)';
                container.style.transition = 'all 0.5s ease';
                
                setTimeout(() => {
                    container.style.opacity = '1';
                    container.style.transform = 'translateY(0)';
                }, 100);
            }, 500);
        }
        
        // Cria o botão
        createFloatingDonationButton();
    });

    // CÓDIGO ORIGINAL DO VERIFICADOR
    const carousel = document.getElementById("carousel");
    const cards = carousel.querySelectorAll(".card");
    let currentCardIndex = 0;
    const totalCards = cards.length;
    let rotationInterval = null;
    let isPopupOpen = false;
   
   // Função para verificar URL
async function verifyURL() {
  const input = document.querySelector('.camp');
  const loading = document.querySelector('.loading');
  const loadingText = document.querySelector('.loading-text');
  const verifyButton = document.querySelector('.popup-verify');
  const resultContainer = document.querySelector('.result-container');
  
  const url = input.value.trim();
  
  // Validar se URL foi inserida
  if (!url) {
    showResult('Por favor, insira uma URL para verificar.', 'warning');
    return;
  }
  
  // Validar formato básico da URL
  if (!isValidURL(url)) {
    showResult('Por favor, insira uma URL válida (ex: https://exemplo.com)', 'error');
    return;
  }
  
  // Mostrar loading
  showLoading(true);
  verifyButton.disabled = true;
  verifyButton.classList.add('loading-active');
  
  try {
    // Usar nova API
    const result = await performURLCheck(url);
    
    // Esconder loading
    showLoading(false);
    
    // Mostrar resultado
    showResult(result.message, result.status);
    
  } catch (error) {
    showLoading(false);
    showResult('Erro ao verificar a URL. Tente novamente.', 'error');
  } finally {
    verifyButton.disabled = false;
    verifyButton.classList.remove('loading-active');
  }
}

// Função para mostrar/esconder loading
function showLoading(show) {
  const loading = document.querySelector('.loading');
  const loadingText = document.querySelector('.loading-text');
  const resultContainer = document.querySelector('.result-container');
  
  if (show) {
    loading.classList.add('show');
    if (loadingText) loadingText.classList.add('show');
    if (resultContainer) resultContainer.classList.remove('show');
  } else {
    loading.classList.remove('show');
    if (loadingText) loadingText.classList.remove('show');
  }
}

// Função para mostrar resultado
function showResult(message, status) {
  const resultContainer = document.querySelector('.result-container');
  
  if (resultContainer) {
    resultContainer.textContent = message;
    resultContainer.className = `result-container show ${status}`;
  }
}

// Validar formato da URL
function isValidURL(string) {
  try {
    new URL(string);
    return true;
  } catch (_) {
    // Tentar com https:// se não tiver protocolo
    try {
      new URL('https://' + string);
      return true;
    } catch (_) {
      return false;
    }
  }
}

async function performURLCheck(url) {
  try {
    // Adicionar https:// se não tiver protocolo
    if (!url.startsWith('http://') && !url.startsWith('https://')) {
      url = 'https://' + url;
    }

    // Fazer POST para sua API
    const submitResponse = await fetch('https://vinixodin.com/api/verificarURL?update=1', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      },
      body: JSON.stringify({
        url: url
      })
    });

    if (!submitResponse.ok) {
      throw new Error('Erro ao submeter URL para análise');
    }

    const submitData = await submitResponse.json();

    // Verificar se houve erro na submissão
    if (submitData.erro) {
      throw new Error(submitData.mensagem || 'Erro na submissão');
    }

    const apiUrl = submitData.api;

    // Loop para verificar resultado (30 tentativas, 1 segundo cada)
    for (let tentativa = 1; tentativa <= 30; tentativa++) {
      console.log(`Tentativa ${tentativa}/30 - Verificando resultado...`);

      try {
        // Aguardar 1 segundo antes de cada tentativa
        await new Promise(resolve => setTimeout(resolve, 5000));

         const resultResponse = await fetch("https://api.allorigins.win/raw?url="+apiUrl, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          }
        });

        if (resultResponse.ok) {
          const resultData = await resultResponse.json();

          // Se o resultado estiver pronto, analisar
          if (resultData && !resultData.message?.includes('not finished')) {
            return analyzeResults(resultData);
          }
        }

        // Se não estiver pronto ainda, continuar o loop
        console.log(`Tentativa ${tentativa}: Resultado ainda não disponível`);

      } catch (fetchError) {
        console.log(`Tentativa ${tentativa}: Erro ao buscar resultado -, fetchError.message`);
        // Continuar tentando mesmo se houver erro individual
      }
    }

    // Se passou de 30 tentativas sem sucesso
    throw new Error('Tempo limite excedido. A análise está demorando mais que o esperado.');

  } catch (error) {
    console.error('Erro na verificação:', error);

    return {
      message: `❌ ${error.message}`,
      status: 'error'
    };
  }
}




// Analisar os resultados do URLScan
function analyzeResults(data) {
    
  try {
    const verdicts = data.verdicts || {};
    
    const hasMalware = verdicts.urlscan.score || 0;
    
    return {
        message: "Chance de malware: "+hasMalware+"%",
        status: "success"
        
    }
    }catch (error) {
    console.error('Erro ao analisar resultados:', error);
    return {
      message: '❌ Erro ao analisar resultado da verificação.',
      status: 'error'
    };
  }
}

// Event listeners para o input
document.addEventListener('DOMContentLoaded', function() {
  const input = document.querySelector('.camp');
  const verifyButton = document.querySelector('.popup-verify');
  
  if (input) {
    input.placeholder = 'Digite a URL para verificar...';
    
    // Verificar quando pressionar Enter
    input.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        verifyURL();
      }
    });
  }
  
  if (verifyButton) {
    verifyButton.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      verifyURL();
    });
  }
});

// Limpar resultado quando começar a digitar
document.addEventListener('input', function(e) {
  if (e.target.classList.contains('camp')) {
    const resultContainer = document.querySelector('.result-container');
    if (resultContainer) {
      resultContainer.classList.remove('show');
    }
  }
});

    // Dynamische stappen en afstand op basis van scherm
    function getResponsiveSettings() {
    const width = window.innerWidth;

    if (width <= 400) return { rotationStep: 45, radius: 160 }; // Zeer compact
    if (width <= 600) return { rotationStep: 50, radius: 200 }; // Mobiel
    if (width <= 768) return { rotationStep: 60, radius: 260 }; // Tablet
    return { rotationStep: 72, radius: 350 }; // Desktop
    }

    function setCardPositions() {
    const { rotationStep, radius } = getResponsiveSettings();
    cards.forEach((card, i) => {
        const rotateY = i * rotationStep;
        const angleRad = (rotateY * Math.PI) / 180;
        const x = Math.sin(angleRad) * radius;
        const z = Math.cos(angleRad) * radius;
        card.style.transform = `translateX(${x}px) translateZ(${z}px) rotateY(${rotateY}deg)`;
    });
    rotateCarousel(); // herbereken rotatiehoek bij aanpassing
    updateCardSize();
    }

    function updateCardSize() {
    cards.forEach((card, i) => {
        if (i === currentCardIndex) {
        card.style.transform += " scale(1.2)";
        card.style.zIndex = "1";
        } else {
        card.style.transform = card.style.transform.replace(" scale(1.2)", "");
        card.style.zIndex = "0";
        }
    });
    }

    function rotateCarousel() {
    const { rotationStep } = getResponsiveSettings();
    const rotateDeg = -rotationStep * currentCardIndex;
    carousel.style.transform = `rotateY(${rotateDeg}deg)`;
    }

    function startRotation() {
    if (rotationInterval || isPopupOpen) return;
    rotationInterval = setInterval(() => {
        currentCardIndex = (currentCardIndex + 1) % totalCards;
        setCardPositions();
    }, 1400);
    }

    function stopRotation() {
    if (rotationInterval) {
        clearInterval(rotationInterval);
        rotationInterval = null;
    }
    }

    carousel.addEventListener("mouseover", () => {
    if (!isPopupOpen) stopRotation();
    });

    carousel.addEventListener("mouseout", () => {
    if (!isPopupOpen) startRotation();
    });

    carousel.addEventListener("touchstart", () => {
    if (!isPopupOpen) stopRotation();
    });

    carousel.addEventListener("touchend", () => {
    if (!isPopupOpen) startRotation();
    });

    function showPopup(cardId) {
    const popup = document.getElementById(`popup-${cardId}`);
    if (popup) {
        popup.classList.add("show");
        isPopupOpen = true;
        stopRotation();
    }
    }

    function closePopup() {
    document.querySelectorAll(".popup").forEach((popup) => {
        popup.classList.remove("show");
    });
    isPopupOpen = false;
    startRotation();
    }

    cards.forEach((card) => {
    card.addEventListener("click", () => {
        const cardId = card.dataset.id;
        showPopup(cardId);
    });
    });

    // Init + resize support
    setCardPositions();
    startRotation();

    window.addEventListener("resize", () => {
    setCardPositions(); // opnieuw positioneren bij vensterverandering
    });

  </script>
</body>
</html>